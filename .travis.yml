dist: trusty
sudo: required

language: cpp
compiler:
  - gcc

env:
  global:
    - secure: "x+x2IMHk0IJKuvDAWcNMi5ifR0dNwpvAkM2axK67YqN2zb0CJzpj87daiEGvf+4268gHk5nBtHQtVxTIjk6B6LmUnya6OwOcs55ZBMrkgc6NiWVxB9+i6n2phdVNbXogWknOBDZhQqTtqqdvbQBJAO3UppdFrDZQF3eb9j+YWMs="
    - secure: "lijVVp4jRIfDkV67yPFdANoAv9oONJSISM/QO7uScMyNUkyDKwCgZbuFsOziJsqZUyGbM3GFCdSK7ufpzM3mlEFQyPckaPCnHyifgzixLlWTn7Krijgt5jMFGqwbSONqLENBhUJi5eAmj2m2lP3Pdmg4U4PPAOTwd5EQvY8uwRU="


before_install:
  - curl http://download.opensuse.org/repositories/science:/dlr/xUbuntu_12.04/Release.key | sudo apt-key add -
  - echo "deb http://download.opensuse.org/repositories/science:/dlr/xUbuntu_12.04/ /" | sudo tee -a /etc/apt/sources.list
  - sudo apt-get update -qq
  - sudo apt-get install -y --force-yes libtixi-dev liboce-dev doxygen cmake cmake-data sshpass
# oce ships a faulty config file, we have to remove it and use standard opencascade detection
  - sudo rm /usr/lib/oce-*/OCEConfig.cmake  
  
before_script:
  - mkdir build
  - cd build

script: 
  - jdk_switcher use oraclejdk8
  - cmake -DTIGL_BUILD_TESTS=ON -DTIGL_BINDINGS_MATLAB=ON -DTIGL_BINDINGS_JAVA=ON -DCMAKE_INSTALL_PREFIX=`pwd`/install ..
  - make
  - make doc
  - make install
  - make check
  - TERM=dumb make tigl-java-demo

after_success:
    - ../ci/travis/deploy.sh
    - cd ..
